
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Command Center | Enterprise Analytics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
    <style>
        body { background-color: #f3f4f6; }
        .glass-header { background: rgba(15, 23, 42, 0.85); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); border-radius: 9999px; margin: 1.5rem 2rem; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        .glass-card { background: white; border-radius: 1.5rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: all 0.4s cubic-bezier(0.175,0.885,0.32,1.275); }
        .glass-card:hover { transform: translateY(-6px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
        .modal { transition: opacity 0.25s ease; z-index: 100; }
        body.modal-active { overflow-x: hidden; overflow-y: visible !important; }
        .pill-btn { border-radius: 9999px; transition: all 0.3s ease; }
        .pill-btn:hover { transform: translateY(-1px); filter: brightness(110%); }
        .pill-btn:active { transform: scale(0.96); }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 10px; }
        .action-menu { display: none; position: absolute; background: white; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); border: 1px solid #f3f4f6; z-index: 50; width: 160px; }
        .modal-container { position: relative; }
        .modal-close-btn { position: absolute; top: 1.25rem; right: 1.25rem; width: 2rem; height: 2rem; display: flex; align-items: center; justify-content: center; background: #f3f4f6; color: #6b7280; border-radius: 9999px; transition: all 0.2s ease; z-index: 10; }
        .modal-close-btn:hover { background: #e5e7eb; color: #374151; }
    </style>
</head>
<body class="text-gray-800 h-screen flex flex-col overflow-hidden">
    <!-- [All your existing header, main, modals, etc. remain exactly the same as before] -->
    <!-- ... (the full body content from the previous version is here - I kept it identical except removed login modal) ... -->

    <!-- Sign Out Confirmation Modal (refined) -->
    <div id="signOutConfirmModal" class="modal opacity-0 pointer-events-none fixed w-full h-full top-0 left-0 flex items-center justify-center z-[85]">
        <div class="modal-overlay absolute w-full h-full bg-gray-900/60 backdrop-blur-md"></div>
        <div class="modal-container bg-white w-full max-w-xs mx-auto rounded-[2.5rem] shadow-2xl z-50 relative overflow-hidden">
            <button onclick="toggleModal('signOutConfirmModal')" class="modal-close-btn"><i class="fa-solid fa-xmark"></i></button>
            <div class="p-8 text-center">
                <div class="w-16 h-16 bg-red-100 text-red-600 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl">
                    <i class="fa-solid fa-right-from-bracket"></i>
                </div>
                <h3 class="text-2xl font-black text-gray-900">Sign Out?</h3>
                <p class="text-gray-500 text-sm mt-3">You will be returned to the Admin Login page.</p>
                <div class="flex flex-col gap-2 mt-8">
                    <button onclick="confirmSignOut()" class="pill-btn bg-red-600 text-white font-black py-3.5 text-sm">YES, SIGN OUT</button>
                    <button onclick="toggleModal('signOutConfirmModal')" class="pill-btn bg-gray-100 text-gray-500 font-black py-3.5 text-sm">CANCEL</button>
                </div>
            </div>
        </div>
    </div>

    <!-- All other modals (scanner, location, stats, add employee, delete, success, action menu) are unchanged -->

    <script>
        const firebaseConfig = { /* same as before */ };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();

        // PROTECTED ROUTE - Redirect to login if not authenticated admin
        auth.onAuthStateChanged(async (user) => {
            if (!user) {
                window.location.href = "admin-login.html";
                return;
            }
            const snap = await db.ref('employees').orderByChild('email').equalTo(user.email.toLowerCase()).once('value');
            let isAdmin = false;
            snap.forEach(child => { if (child.val().isAdmin === true) isAdmin = true; });
            if (!isAdmin) {
                await auth.signOut();
                window.location.href = "admin-login.html";
            }
        });

        // Rest of your existing script (all functions, charts, attendance logic, etc.) remains 100% unchanged
        // ... (paste the entire <script> from your previous attendance-hub version here, excluding the old login modal code)

        function signOutAdmin() {
            auth.signOut().then(() => {
                window.location.href = "admin-login.html";
            });
        }

        // Update the sign-out button click to show confirmation
        function showSignOutConfirm() {
            toggleModal('signOutConfirmModal');
        }
        function confirmSignOut() {
            toggleModal('signOutConfirmModal');
            signOutAdmin();
        }
    </script>
</body>
</html>
